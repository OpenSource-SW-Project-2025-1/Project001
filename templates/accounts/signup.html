{% extends 'base.html' %}
{% load static %}
{% block content %}
<main class="main">
    <h2 class="login-title">회원가입</h2>

  <div class="form-guidelines">
    <p><strong style="color:red">* </strong>표시는 필수 입력 항목입니다.</p>
    <p>비밀번호와 아이디는 영문자, 숫자만 이용해 입력해 주세요.</p>
  </div>
    <script>
        document.getElementById('signup-btn').disabled = true;
    </script>

  <form class="signup-form">
    <!-- 아이디 / 비밀번호 -->
    <div class="form-box">
      <div class="input-group">
        <label>아이디 <span class="required">*</span> <small>영문( 소문자 )와 숫자를 조합해 3~5자</small></label>
        <div class="inline-group">
          <input type="text" id="username" placeholder="아이디 입력">

          <button class="check-btn" type="button" onclick="checkDuplicate()" >중복 확인</button>
        </div>
      </div>
        <script>
            function checkDuplicate() {
             const username = document.getElementById('username').value;

                 if (!/^[a-z0-9]{3,5}$/.test(username)) {
                     alert("아이디는 소문자+숫자 조합 3~5자여야 합니다.");
                     return;
                 }

               fetch(`/check-username/?user=${username}`)
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        alert("이미 존재하는 아이디입니다.");
                        document.getElementById('signup-btn').disabled = true;
                    } else {
                         alert("사용 가능한 아이디입니다.");
                        document.getElementById('signup-btn').disabled = false;
                    }
                });
            }
        </script>

      <div class="input-group">
        <label>비밀번호 <span class="required">*</span></label>
        <input type="password" id="password" placeholder="9~24자, 대/소문자, 숫자 포함">
      </div>

      <div class="input-group">
        <label>비밀번호 확인 <span class="required">*</span></label>
        <input type="password" id="confirm-password" placeholder="비밀번호 다시 입력">
      </div>

        <script>
            function validatePassword() {
              const pw = document.getElementById('password').value;
              const confirm = document.getElementById('confirm-password').value;
              const signupBtn = document.getElementById('signup-btn');
              const pwRule = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{9,24}$/;

                  if (!pwRule.test(pw)) {
                    alert("비밀번호는 9~24자, 대/소문자 및 숫자를 포함해야 합니다.");
                    signupBtn.disabled = true;
                    return false;
                  }

                    if (pw !== confirm) {
                        alert("비밀번호가 일치하지 않습니다.");
                        signupBtn.disabled = true;
                        return false;
                    }

                signupBtn.disabled = false;
                return true;
            }

            // 이벤트 연결
            document.getElementById('password').addEventListener('input', validatePassword);
            document.getElementById('confirm-password').addEventListener('input', validatePassword);
        </script>

      <div class="input-group">
        <label>사용자 이메일 <span class="required">*</span></label>
        <input type="email" placeholder="이메일 입력">
      </div>

      <div class="input-group">
        <label>사용자 번호 <span class="required">*</span></label>
        <input type="text" placeholder="숫자만 입력">
      </div>
    </div>

    <!-- 거주 정보 -->
    <div class="form-box">
      <div class="input-group">
        <label>거주지역 <span class="required">*</span></label>
        <div class="inline-group">
          <input type="text" placeholder="거주지 입력">
          <button class="check-btn" type="button">지역 찾기</button>
        </div>
      </div>

      <div class="input-group">
        <label>생년월일 <span class="required">*</span></label>
        <input type="date">
      </div>

      <div class="inline-pair">
        <div class="input-group">
          <label>혼인 여부</label>
          <input type="text" placeholder="기혼/미혼">
        </div>
        <div class="input-group">
          <label>형제자매 수</label>
          <div class="with-unit">
            <input type="number" placeholder="숫자">
            <span>명</span>
          </div>
        </div>
      </div>

      <div class="input-group">
        <label>취업 상태</label>
        <input type="text" placeholder="예: 미취업, 재직 중">
      </div>

      <div class="input-group">
        <label>소속</label>
        <input type="text" placeholder="학교, 회사 등">
      </div>

      <div class="input-group">
        <label>연 평균 소득 (단위 : 만 원)</label>
        <div class="with-unit">
          <input type="text" placeholder="숫자">
          <span>만원</span>
        </div>
      </div>

      <div class="input-group checkbox-group">
        <label>
          <input type="checkbox"> <strong>개인정보 이용 동의</strong>
        </label>
        <small>개인정보 이용 동의서 확인</small>
      </div>

      <div class="submit-area">
        <button type="submit" class="signup-btn">SIGN</button>
      </div>
    </div>
  </form>
</main>
{% endblock %}
